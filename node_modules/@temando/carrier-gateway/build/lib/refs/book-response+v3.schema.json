{
  "id": "http://carrier-gateway.temando.com/schema/book-response+v3#",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "allOf": [{
    "$ref": "#/definitions/bookingServiceResponse"
  }],
  "definitions": {
    "packages": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/package"
      }
    },
    "bookingServiceResponse": {
      "required": [
        "integrationId"
      ],
      "properties": {
        "clientId": {
          "type": "string"
        },
        "integrationId": {
          "type": "string"
        }
      },
      "oneOf": [{
        "$ref": "#/definitions/failedBooking"
      }, {
        "$ref": "#/definitions/successfulBooking"
      }]
    },
    "failedBooking": {
      "required": ["failedBooking"],
      "properties": {
        "failedBooking": {
          "type": "object",
          "required": ["reasons"],
          "properties": {
            "reasons": {
              "type": "array",
              "items": {
                "type": ["string", "object"]
              },
              "minItems": 1
            }
          }
        }
      }
    },
    "successfulBooking": {
      "required": ["successfulBooking"],
      "properties": {
        "successfulBooking": {
          "type": "object",
          "properties": {
            "integrationServiceId": {
              "type": "string"
            },
            "bookingReference": {
              "type": "string"
            },
            "shippingTaxInclusiveCharge": {
              "$ref": "http://carrier-gateway.temando.com/schema/generic/money+v1#"
            },
            "pricedAt": {
              "type": "string",
              "format": "date-time"
            },
            "documentation": {
              "$ref": "#/definitions/documentation"
            }
          },
          "required": [
            "integrationServiceId",
            "bookingReference",
            "shippingTaxInclusiveCharge",
            "pricedAt"
          ]
        }
      }
    },
    "label": {
      "type": "object",
      "required": [
        "description",
        "encoding",
        "mimeType"
      ],
      "oneOf": [{ "required": ["data"] }, { "required": ["url"] }],
      "properties": {
        "description": {
          "type": "string",
          "description": "A human understandable description of the label content"
        },
        "encoding": {
          "description": "The encoding of the data",
          "type": "string",
          "enum": [
            "base64",
            "plainText"
          ]
        },
        "mimeType": {
          "type": "string",
          "description": "A MIME type identifier"
        },
        "data": {
          "description": "The label data as a string",
          "type": "string"
        },
        "url": {
          "description": "The URL of a label stored on a remote HTTP server",
          "type": "string",
          "format": "uri"
        }
      }
    },
    "package": {
      "type": "object",
      "allOf": [{
        "$ref": "http://carrier-gateway.temando.com/schema/generic/package+v1#"
      }],
      "properties": {
        "documentation": {
          "$ref": "#/definitions/documentation"
        },
        "trackingReference": {
          "type": "string",
          "minLength": 2,
          "description": "A unique tracking number assigned to this package"
        }
      }
    },
    "documentation": {
      "type": "array",
      "items": { "$ref" : "#/definitions/label" }
    }
  }
}
