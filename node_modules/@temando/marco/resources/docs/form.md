# Forms Guide

```json
{
  controlSets: [...],
  httpRequest: {...},
  ...
}
```

A form consists of inputs/controls which usually result in a HTTP request. A Marco definition may consist of just a single form, when that is all that is required to fulfil the requirements e.g. create location

- [Schema: Form](../schemas/generic/form/form+v1.schema.json)
- [Sample: Form](../samples/sample-marco-form-response.json)
- [Guide: Validation](validation.md)

Any user-facing message (titles, labels, etc.) needs to exist as a message ([schema](../schemas/generic/message+v1.schema.json)), for the purpose of future translation. See the [Messages Guide](messages.md).

## Form Structure

Form consists of:

- Title
- Description
- Control Sets
- HTTP Request

### Title

Form title that will be used in a UI.

### Description

Form description that will be used in a UI to help user understand context.

### Control Sets

Represents set of control sets which are logical grouping of form controls/fields (e.g. address within user info form). In essence can be thought of as being a set of `<fieldset>`s.

Control Set can have visibility and/or disabled dependency:

- [Control Set visibility and disabled definition](../schemas/generic/form/dependency+v1.schema.json)

### Controls

Control Set consists of controls. Each control has ID. Control IDs are used for referencing between controls for validation, visibility dependency and disable dependency. [Control schema](../schemas/generic/form/form+v1.schema.json) defines controls structure.

Control can have:

- Default value - can be static, retrieved from state or be generated (UUID or date)
- Visibility and/or disabled dependency - [Control dependency schema](../schemas/generic/form/dependency+v1.schema.json)
- Validation rules - [Control validation rule schema](../schemas/generic/form/controls/validation-rule+v1.schema.json)

### HTTP Request

Defines how the form request data is submitted. [HTTP request schema](../schemas/generic/http-request/http-request+v1.schema.json) defines its structure.

#### URL

The URL can include placeholders indicated by curly braces. `"http://example.com/{type}/{id}/"` where `type` and `id` are replacable URL params. There must be an item in the `urlParams` array for each placeholder, and they should result in a non-empty value. Values can either be static or retrieved from state with [transforms](#transforms) applied.

#### Headers

Each item in the `headers` array is evaluated. If it results in a value, the header is included. Values can either be static or retrieved from state with [transforms](#transforms) applied.

#### Request Data

The request data is built in two passes:

1. Controls which are visible and have a `ref` will have the control value mapped into the request at that `ref` path.

1. Each item in the `requestData` array is evaluated. If it results in a value, the value is mapped into the request at that `ref`. The value can either be static or retrieved from state with [transforms](#transforms) applied.

### Transforms

Transforms defined by [Transform schema](../schemas/generic/transform/transform+v1.schema.json) are executed in series. If a transform is unable to act on an input's data type, the input is passed through to the next transform.

Supported transform types:

| Transform        | Input type(s)                         | Output type(s) | Description                                                                                                                         |
| ---------------- | ------------------------------------- | -------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `buildString`    | `object`                              | `string`       | Given an object and a provided format template, return a formatted string with object values inserted                               |
| `changeShape`    | `object`                              | `object`       | Creates a new object and allows values to be arbitrarily accessed from the input and placed into the output with JSON pointer pairs |
| `formatAddress`  | `object`                              | `string`       | Given an object with standard address keys, return a formatted string                                                               |
| `formatCurrency` | `{ value: number, currency: string }` | `string`       | Return a formatted currency string from the input and the current locale                                                            |
| `formatDate`     | `string`                              | `string`       | Given a parsable date (usually ISO), return a formatted string following a provided template                                        |
| `getAttribute`   | `array`                               | `integer`      | Currently only supports returning an input array's `length`                                                                         |
| `getValue`       | `object`                              | `any`          | Retrieves a value from the input with a JSON pointer                                                                                |
| `prefixString`   | `string`                              | `string`       | Allows a static value to be prefixed to an input string                                                                             |
| `transformEach`  | `array`                               | `array`        | Applies a transform to each item of the input array                                                                                 |
