const Ajv = require('ajv');
const chai = require('chai');
chai.use(require('dirty-chai'));
const expect = chai.expect;

const messageV1Schema = require('../../../message+v1.schema.json');
const exactlengthValidationSchema =
  require('../exact-length-rule+v1.schema.json');

const ajv = new Ajv();

ajv.addSchema(messageV1Schema);
ajv.addSchema(exactlengthValidationSchema, 'exactLengthValidation');

describe('Testing exact length schema', function() {
  it('should be valid when having exact and notExact message', function() {
    const isValid = ajv.validate('exactLengthValidation', {
      "exact": 5,
      "messages": {
        "notExact": {
          "messageKey": "form.string.notExact"
        }
      }
    });

    if (!isValid) console.log(ajv.errors);

    expect(isValid).to.be.ok();
  });

  it('should be valid and not care about other properties and message keys', function() {
    const isValid = ajv.validate('exactLengthValidation', {
      "exact": 5,
      "randomProperty": "for sure ignore",
      "messages": {
        "notExact": {
          "messageKey": "form.string.notExact"
        },
        "someRandomKeyToIgnore": "yes please ignore"
      }
    });

    if (!isValid) console.log(ajv.errors);

    expect(isValid).to.be.ok();
  });

  it('should be invalid when having no `exact` defined', function() {
    const isValid = ajv.validate('exactLengthValidation', {
    });

    if (isValid) throw new Error('Should not be valid, should throw `exact` required');

    expect(ajv.errors[0].message).to.be.equal('should have required property \'exact\'');
  });

  it('should be invalid when having exact and no messages', function() {
    const isValid = ajv.validate('exactLengthValidation', {
      "exact": 5
    });

    if (isValid) throw new Error('Should not be valid, should throw \`messages\' required');

    expect(ajv.errors[0].message).to.be.equal('should have required property \'messages\'');
  });

  it('should be invalid when having exact and not notExact message', function() {
    const isValid = ajv.validate('exactLengthValidation', {
      "exact": 5,
      "messages": {
      }
    });

    if (isValid) throw new Error('Should not be valid, should throw \`notExact\' required');

    expect(ajv.errors[0].message).to.be.equal('should have required property \'notExact\'');
  });
});
