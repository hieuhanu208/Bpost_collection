const Ajv = require('ajv');
const chai = require('chai');
chai.use(require('dirty-chai'));
const expect = chai.expect;

const messageV1Schema = require('../../../message+v1.schema.json');
const maxLengthValidationSchema =
  require('../maximum-length-rule+v1.schema.json');

const ajv = new Ajv();

ajv.addSchema(messageV1Schema);
ajv.addSchema(maxLengthValidationSchema, 'maxLengthValidation');

describe('Testing maximum length schema', function() {
  it('should be valid when having maximum and tooLong message', function() {
    const isValid = ajv.validate('maxLengthValidation', {
      "maximum": 5,
      "messages": {
        "tooLong": {
          "messageKey": "form.string.tooLong"
        }
      }
    });

    if (!isValid) console.log(ajv.errors);

    expect(isValid).to.be.ok();
  });

  it('should be valid and not care about other properties and message keys', function() {
    const isValid = ajv.validate('maxLengthValidation', {
      "maximum": 5,
      "randomProperty": "for sure ignore",
      "messages": {
        "tooLong": {
          "messageKey": "form.string.tooLong"
        },
        "someRandomKeyToIgnore": "yes please ignore"
      }
    });

    if (!isValid) console.log(ajv.errors);

    expect(isValid).to.be.ok();
  });

  it('should be invalid when having no maximum defined', function() {
    const isValid = ajv.validate('maxLengthValidation', {
    });

    expect(ajv.errors[0].message).to.be.equal('should have required property \'maximum\'');
  });

  it('should be invalid when having maximum and no messages', function() {
    const isValid = ajv.validate('maxLengthValidation', {
      "maximum": 5
    });

    expect(ajv.errors[0].message).to.be.equal('should have required property \'messages\'');
  });

  it('should be invalid when having maximum and not tooLong message', function() {
    const isValid = ajv.validate('maxLengthValidation', {
      "maximum": 5,
      "messages": {
      }
    });

    expect(ajv.errors[0].message).to.be.equal('should have required property \'tooLong\'');
  });
});
