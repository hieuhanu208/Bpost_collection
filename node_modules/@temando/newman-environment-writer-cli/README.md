# Temando Newman CLI

The `temando-newman` CLI tool exposes a single command, `env`. It's purpose is to 
replace Postman environment variables with those from the Temando Service Registry
and/or the AWS Shared Credentials to aid in CI/CD.

## Install

```bash
$ npm install @temando/newman-environment-writer-cli --save
```

## Usage

```bash
$ temando-newman env write <path/to/postman-environment>
Environment written to <path/to/postman-environment>

$ temando-newman env write <path/to/postman-environment> --definition <path/to/ts-definition>
Environment written to <path/to/postman-environment>

$ temando-newman env write <path/to/postman-environment> --output <path/to/output-environment> --region us-east-1
Environment written to <path/to/output-environment>
```

There are optional parameters for the command:

- `-d, --definition` Where the `ts-definition.json` file can be found. Defaults to the current working directory if omitted.
- `-o, --output` Where the environment should be written. Defaults to replacing the `<environment>` file if omitted.
- `-r, --region` Choose a specific deployment when the service is deployed in multiple AWS regions. Defaults to first deployment if omitted.

## How it works

This tool will look to replace an environment variable called `endpoint` with the deployment information obtained for the service defined by the `--definition` file. If no `--region` parameter is passed, it will default to using the first available deployment.

## FAQs

1. I get a `No deployment information found for {my-service}` error.

Deployment information for services is usually added during the Gitlab CI deploy process by the [Serverless Temando Service Registry Plugin](https://src.temando.io/service-registry/serverless-temando-service-registry-plugin). Check that the plugin is added to your project and the service is being deployed correctly.

2. I get a `Given environment is invalid, missing "values" property` error.

Ensure that you are passing a Postman Environment file to `write` command and not just a Postman variables file. This project contains an [example-env](resources/example-env.json) file for the Instrumentation Gateway project.

## Contributing

See the [Contributors Guide](CONTRIBUTING.md)
