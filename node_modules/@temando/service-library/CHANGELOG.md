# Changelog

The format: [Keep a Changelog](http://keepachangelog.com/en/1.0.0/)

## [Unreleased]

## [7.1.1][] - 2017-09-21

### Changed

- Bump `@temando/instrument` to `v4.1.1`.

## [7.1.0][] - 2017-09-21

### Added

- Tslint now uses type checks
- Exporting from `@temando/service-library/middlewares/JsonApi`
  - `IJsonApiEvent`, `IJsonApiResponse`. These describe the JSON API body structure in full.

## [7.0.6][] - 2017-09-20

### Changed

- Removed `direction` from `Instrumentation` and `AddServiceClientFactory` middlewares.
- `Instrumentation` middleware now reports metrics as `service.http.*`, not `http.*`.

## [7.0.5][] - 2017-09-20

### Added

- `AddServiceClientFactory` and `Instrumentation` middleware now report `http.timing` metrics.

## [7.0.4][] - 2017-09-18

### Fixed

- Fixed setting of `callDepth` in `AddServiceClientFactory` instrumentation.

## [7.0.3][] - 2017-09-18

### Added

- `AddServiceClientFactory` middleware now reports `http.request`, `http.request.error` and `http.response` metrics.

## [7.0.2][] - 2017-09-18

### Added

- `Instrumentation` middleware now reports `http.request`, `http.request.error` and `http.response` metrics.
- The `LambdaHttp` handler now emits a new event, `http.exception` whenever an error present.

### Changed

- Upgraded `@temando/instrument` to include TS definition fixes.

## [7.0.1][] - 2017-09-18

### Changed

- Update to SearchFilter input validation:
  1. Validate client provided list filter object against the services' `filterFieldConfig`.
  2. Validate client provided list filter object against the Generic Schema filter schema.

This will ensure that any errors provided back to the client are specific to the service being called.

### Added

- `generateOpenApiFilterParameter` helper to generate filter parameter for endpoints that are using `SearchFilter` middleware.

### Fixed

- Improve type usability in projects that use the exported types from this project:
  - `IHttpMwEventSignatures` is now pulled directly from the `Http` middleware.
  - `IKinesisMwEventSignatures` is now pulled directly from the `Kinesis` middleware.
- Fix usage of Instrument client

## [7.0.0][] - 2017-09-06

### Changed

- `@temando/service-client-factory` and `@temando/service-client-factory` are now `peerDependencies`
  - The service must provide them, matching the specified version
  - They also reside as `devDependencies` for tests
- Dependencies upgraded

### Deprecated

- `Schema` middleware has been deprecated. Use `SchemaValidator` to wrap your AJV schemas.

## 6.0.4 - 2017-08-22

- Fix type on `LambdaHttp` and `MiddlewareInterface`.

## 6.0.3 - 2017-08-21

### Changed

- `ParseRequest` now extracts the `code` from the headers, as this is required by the Service Client Factory.
- Types changed in regards to the middleware interfaces. `event` object should no longer have an `any` type and most events will auto-complete. There are caveats as middlewares using the same names cannot guarantee the right type, so some assertion on the users part is necessary still.

### Added

- `LambdaBatch` handler added
- `Kinesis` middleware added

### Internal

- Added integration tests for the `Kinesis` handler/middleware
  - This should be a good base to work new int tests from, among being an example project

## [6.0.2] - 2017-08-20

### Changed

- replace workaround for fetch body used issue with a better solution see [github.com/node-fetch#bodybodyused](https://github.com/bitinn/node-fetch#bodybodyused)

## [6.0.1] - 2017-08-20

### Changed

- bugfix to workaround body used issue see [github.com/node-fetch#bodybodyused](https://github.com/bitinn/node-fetch#bodybodyused)

## [6.0.0] - 2017-08-19

### Changed

- Updated the `AddServiceClientFactory` middleware to attempt to get `code` from the headers to add to ServiceClientFactory constructor.
- Upgrade `@temando/service-client-factory` and `@temando/storage-library` dependencies.
- `AddStorageLibrary` Middleware now uses `optionalDependency` included storage-library instead of accepting an instantiated `StorageLibrary` instance
- removed dependency on serviceClientFactory from Instrumentation middleware

### Added

- add basic instrumentation logging for service client factory events
- added missing `storage.ready` event declaration

## [5.1.0] - 2017-08-17

### Removed

- Temando Error classes have been moved to their own package, `@temando/errors`.

## [5.0.0] - 2017-08-14

Changes:

- [x] `generateSearchableIndexes` helper function added
- [x] The `Mediator`'s configuration option `DEBUG` (`IDebug`) is now a simple boolean.
- [x] `Mediator` runs in production mode by default, which includes no console output. If you require debug output (such as events emitted to no listeners, or undeclared events), set an environment variable `T_DEBUG` to `true`.

- [x] `AddServiceClientFactory` middleware added
- [x] ServiceClientFactory bumped to latest major
- [x] StorageLibrary bumped
- [x] InstrumentLibrary bumped
- [x] `Instrumentation` now no longer requires `tsEnv`


## [4.7.0] - 2017-08-08

Changes:

- [x] Now provides a sample webpack configuration from `@temando/service-library/webpack/webpack.config`

## [4.6.1] - 2017-08-06

Changes:

- [x] Updated `"@temando/generic-schema` package from `0.12.0` to `0.18.2`

## [4.6.0] - 2017-08-04

Changes:

- [x] `Billing` middleware now send metrics directly to SQS instead of using `Instrumentation`
- [x] `Billing` middleware now has unit tests
- [x] `requestContext` added to `IInputLambdaHttpEvent` interface

## [4.5.0] - 2017-06-04

Changes:

- [x] `IInputLambdaEvent` was split into `IInputLambdaHttpEvent` and `IInputLambdaEvent`
  - The regular `Lambda` handle was expecting a LambdaHttp input incorrectly. Now they are seperate
  - NOTE: `ILambdaEvent` is a catch all, and the structure could be shaped better or split into multiple types

## [4.4.0] - 2017-05-28

Changes:

- [x] `5xx` errors now extend `InternalError` instead of `TemandoError` directly

Deprecated:

- [x] `NotImplimentedError` will be removed in the next major version. Use `NotImplementedError` instead.
- [x] `UnavaliableError` will be removed in the next major version. Use `UnavailableError` instead.

## [4.2.0] - 2017-05-16

Features:

- [x] `AddStorageLibrary` middleware to attach a `StorageLibrary` instance to event
- [x] `ParseRequest` middleware to extract commonly required data from event
- [x] logic to `Instrumentation` middleware to automatically log incoming requests and outgoing responses

## [4.0.0] - 2017-05-11

Breaking changes:

- [x] Now builds to target `es2015`, this will only work on node `6` and up.
- [x] Most modules now do not use a `export default`, this likely has broken projects pathing to a specific module
- [x] SearchFilter directory restructured

Features:

- [x] Types have been significantly improved, and each middleware exposes some interface in order to piece toegether a fully enriched event
- [x] Various misc logic tweaks highlighted by Typescript

Changes:

- [x] `UNUSED` event messages by default will not be emitted by `DEBUG` in the Mediator

## [3.7.0] - 2017-04-03

Features:

- [x] Added new middleware, `SearchFilter`
    - For use with the new temando-storage-library@1.0

## [3.5.0] - 2017-02-22

Features:

- [x] Added `qs` as the `queryStringParameters` parser for the `LambdaHttp` handler

## [0.2.1] - 2017-01-17

Features:

- [x] Get working
- [x] JSON API content type headers in LambdaProxyHandler

## [0.0.1] - 2017-01-10

- Initial commit


[Unreleased]: https://src.temando.io/service-library/temando-service-library/compare/v7.1.1...HEAD
[7.1.1]: https://src.temando.io/service-library/temando-service-library/compare/v7.1.0...v7.1.1
[7.1.0]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.6...v7.1.0
[7.0.6]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.5...v7.0.6
[7.0.5]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.4...v7.0.5
[7.0.4]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.3...v7.0.4
[7.0.3]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.2...v7.0.3
[7.0.2]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.1...v7.0.2
[7.0.1]: https://src.temando.io/service-library/temando-service-library/compare/v7.0.0...v7.0.1
[7.0.0]: https://src.temando.io/service-library/temando-service-library/compare/v6.2.0...v7.0.0
[6.2.0]: https://src.temando.io/service-library/temando-service-library/tree/v6.2.0
