# Instrument Client

An instrument client for logging and metrics for AWS Lambda services.

## Installation

Install through npm:

```sh
$ npm install @temando/instrument --save
```

## Usage

The examples below are not definitive but can be used to help you get started.

Please change string values and context objects and other settings where required.

### Logs

```javascript
import { InstrumentClient } from '@temando/instrument';

const instrument = new InstrumentClient({
  consumerServiceName: 'my-sample-service'
});

// Level and message set for 'info' log
instrument.info('Sending request', { requestBody: request });
```

### Metrics

```javascript
import { InstrumentClient } from '@temando/instrument';

const instrument = new InstrumentClient({
  consumerServiceName: 'my-sample-service'
});

// Type, name and value set for metric
instrument.metric('count', `Request ${document.integrationId}`, 1);

// Count convenience method
instrument.count(`Request ${document.integrationId}`, 1);

// Timing convenience method
instrument.timing(name, timeInMicroseconds);
```

### API

```javascript
import { InstrumentClient } from '@temando/instrument';

const instrument = new InstrumentClient({
  consumerServiceName: 'my-sample-service'
});

// LOGS
instrument.log(level, message[, context]);

// LOGS (convenience methods)
instrument.emergency(message[, context]);
instrument.alert(message[, context]);
instrument.critical(message[, context]);
instrument.error(message[, context]);
instrument.warning(message[, context]);
instrument.notice(message[, context]);
instrument.info(message[, context]);
instrument.debug(message[, context]);

// METRICS
instrument.metric(type, name, value, context)

// METRICS (convenience methods)
instrument.count(name, by = 1, context);
instrument.gauge(name, value, context);
instrument.timing(name, value, context);
instrument.histogram(name, value, context);

// TIMERS (convenince for timing operations)
const timer = instrument.timer();
instrument.timing(name, timer);
```

## Temando Metrics

See the [Guide to Temando Metrics](https://src.temando.io/project-phoenix/instrumentation-gateway/blob/master/resources/guide_to_temando_metrics.md) and the [Instrument Gateway](https://src.temando.io/project-phoenix/instrumentation-gateway).

## Log Levels

Instrumentation gateway supports the logging levels described by [RFC 5424](http://tools.ietf.org/html/rfc5424).
When logging consider the level of the message as **CRITICAL**, **ALERT**, **EMERGENCY** will generally result in human action.

- **DEBUG**: Detailed debug information.
- **INFO** : Interesting events. Examples: User logs in, SQL logs.
- **NOTICE**: Normal but significant events.
- **WARNING**: Exceptional occurrences that are not errors. Examples:
  Use of deprecated APIs, poor use of an API, undesirable things that are not
  necessarily wrong.
- **ERROR**: Runtime errors that do not require immediate action but
  should typically be logged and monitored.
- **CRITICAL**: Critical conditions. Example: Application component
  unavailable, unexpected exception.
- **ALERT**: Action must be taken immediately. Example: Entire website
  down, database unavailable, etc. This should trigger the SMS alerts and wake
  you up.
- **EMERGENCY**: OMG

### Testing

By default, the Instrument Library will console log all methods that are called. This can make reading the results of tests hard. To disable this output, set the environment to test mode.

```javascript
"scripts": {
    "...",
    "test": "NODE_ENV=test ..."
  },
```
